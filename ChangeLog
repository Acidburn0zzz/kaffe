2003-06-28  Helmer Kraemer  <hkraemer@freenet.de>

	* libraries/javalib/kaffe/lang/ThreadStack:
	(getCallersClassLoader): new method
	
	* libraries/javalib/java/lang/Class.java 
	(CallStack): removed
	(forName): use ThreadStack.getCallersClassLoader

	* libraries/javalib/java/lang/Package.java,
	libraries/javalib/java/lang/System.java,
	libraries/javalib/java/lang/Runtime.java:
	use ThreadStack.getCallersClassLoader instead of
	Class.CallStack.getCallersClassLoader

	* libraries/javalib/java/util/ResourceBundle.java:
	(getBundle): use ThreadStack.getCallersClassLoader if loader
	is null
	(getSpecificBundle): throw NPE if loader is null

	* libraries/javalib/bootstrap.classlist,
	libraries/javalib/Klasses.jar.bootstrap:
	removed java/lang/Class$CallStack.class and
	kaffe/lang/DummyClassLoader.class

	* libraries/javalib/essential.files:
	remove kaffe/lang/DummyClassLoader.java

	* libraries/javalib/kaffe/lang/DummyClassLoader.java:
	removed

	* libraries/javalib/Makefile.am,
	libraries/javalib/Makefile.in:
	regenerated

	* test/regression/ProcessClassInst.java,
	test/regression/ProcessClassStop.java:
	adjusted line numbers in expected output
	
2003-06-28  Helmer Kraemer  <hkraemer@freenet.de>

	* kaffe/kaffevm/jit/machine.c:
	(translate) use lockClass to guard translation so it doesn't
	interfere with static synchronized methods
	(installMethodCode) free the trampoline before overwriting it

	* kaffe/kaffevm/jit3/machine.c:
	(installMethodCode) free the trampoline before overwriting it

	* kaffe/kaffevm/soft.c:
	(soft_fixup_trampoline) use COMPARE_AND_EXCHANGE/ATOMIC_EXCHANGE
	to update the trampoline; free the trampoline if necessary

2003-06-27  Rob Gonzalez <rob@kaffe.org>

	The following files were updated to provide additional macro
	support for accessing internal kaffe data in classes and methods.
	The new macros will be used extensively in pass 2 verification.
	
	* kaffe/kaffevm/access.h
	Added ACC_STRICT macro.

	* kaffe/kaffevm/constants.h
	Enhanced macro set for picking apart a class's constant pool.
	i.e. added METHODREF_SIGNATURE(...) and others.

	* kaffe/kaffevm/classMethod.h
	Enhanced macro set for checking a method's flags.
	i.e. added METHOD_IS_PROTECTED(...) and others.

2003-06-26  Motoyuki Kasahara <m-kasahr@sra.co.jp>

	* configure.in:
	Don't add $LIBICONV to LIBS, it can break other tests.

	* libraries/clib/native/Makefile.am:
	(libnative_la_LIBADD) added LTLIBICONV

	* sockinttypes.m4:
	If configure fails to get size of sin_port in struct sockaddr_in,
	it outputs an error message and exits immediately.
	
2003-06-26  Dalibor Topic <robilad@yahoo.com>

	Updated iconv detection to GNU gettext release 0.11.3. The new
	version of iconv.m4 triggered the merge of GPL'd autoconf-lib-link
	m4 code from GNU gettext.

	* iconv.m4: Updated to latest version from gettext 0.11.3.

	* lib-link.m4, lib-ld.m4, lib-prefix.m4: new file.

	* Makefile.am:
	(EXTRA_DIST) added lib-link.m4, lib-ld.m4 and lib-prefix.m4.

	Reported by: Ito Kazumitsu <kaz@maczuka.gcd.org>

2003-06-26  Rob Gonzalez <rgonzale@wso.williams.edu>

	* kaffe/man/kaffe.1.in:
	include documentation for -verifyremote in the man page.

2003-06-25  Dalibor Topic <robilad@yahoo.com>

	* include/defs.h:
	(VA_LIST_COPY) fixed array copying macro to use its variables.
	
2003-06-25  Dalibor Topic <robilad@yahoo.com>

	* libraries/javalib/Makefile.am.in:
	(rt.jar) depend on all class library sources.

	Reported by: Rob Gonzalez <rgonzale@wso.williams.edu>

2003-06-25  Dalibor Topic <robilad@yahoo.com>

	* kaffe/kaffevm/jit3/funcs.c:
	(ALIGN) renamed to ALIGN_CODEPC to fix a warning on OpenBSD.

	* FAQ/FAQ.jit3: renamed ALIGN to ALIGN_CODEPC.
	
2003-06-25  Dalibor Topic <robilad@yahoo.com>

	* libraries/clib/math/BigInteger.c:
	(Java_java_math_BigInteger_scansetbit0,
	Java_java_math_BigInteger_cmp0,
	Java_java_math_BigInteger_toString0,
	Java_java_math_BigInteger_toDouble0,
	Java_java_math_BigInteger_toInt0,
	Java_java_math_BigInteger_probablyPrime0,
	Java_java_math_BigInteger_bitLength0,
	Java_java_math_BigInteger_hamDist0) added return statements in
	dummy implementations to fix compiler warnings.
	
2003-06-25  Dalibor Topic <robilad@yahoo.com>

	* valist.m4: new file. valist handling macros taken from GPL-d
	Quakeforge. Thanks to Bill Currie <taniwha@quakeforge.org>.

	* configure.in: removed explicit va_list checking, now uses macros
	from valist.m4.

	* Makefile.am:
	(EXTRA_DIST) added valist.m4

	* include/defs.h:
	(VA_LIST_COPY) use memcpy if neither va_copy nor __va_copy are
	available and va_list is an array.

	* stringParsing.c:
	(parseString_private) fix powerpc-linux comilation warnings.

	Reported by: Luca Saiu <positrone@freemail.it>,
	             Marc Kleine-Budde <kleine-budde@gmx.de>
	
2003-06-24  Dalibor Topic <robilad@yahoo.com>

	* libraries/clib/native/ClassLoader.c:
	(java_lang_ClassLoader_defineClass0) removed unneeded variable.

	* libraries/clib/net/PlainsocketImpl.c:
	(java_net_PlainSocketImpl_socketAccept) initialize remote_addr
	with NULL.

2003-06-24  Dalibor Topic <robilad@yahoo.com>

	* config/config-mem.h:
	Include <stdlib.h> if the system has it, instead of <malloc.h>, to
	fix warnings on FreeBSD 4.8.
	
2003-06-24  Dalibor Topic <robilad@yahoo.com>

	* Makefile.am:
	(EXTRA_DIST) removed
	developers/getaddrinfo-socketinttypes-glibc2.diff. added
	developers/patch-libtool-amiga-max-command-line-length.diff.
	
2003-06-24  Dalibor Topic <robilad@yahoo.com>

	* config/i386/freebsd2/md.h:
	(SIGNAL_CONTEXT_POINTER) removed unnecessary concatenation.

2003-06-24  Luca Saiu <positrone@freemail.it>

	* kaffe/kaffevm/systems/unix-jthreads/jthread.c:
	(SIGNAL_CONTEXT_POINTER) removed unnecessary concatenation, fixing
	compilation problems on gcc 3.3.
	
2003-06-24  Dalibor Topic <robilad@yahoo.com>

	* herrno.m4, in6addr.m4, include/dummyin6.h, replace/dummyin6.c,
	replace/getaddrinfo.c, replace/memset.c, sockaddrin6.m4,
	sockinttypes.m4: updated to getaddrinfo 1.6.
	
	Reported by:  Ito Kazumitsu <kaz@maczuka.gcd.org>
	
2003-06-24  Dalibor Topic <robilad@yahoo.com>

	* developers/patch-libtool-amiga-max-command-line-length.diff:
	new file.
	
	* developers/autogen.sh:
	patch libtool to avoid spending too much time checking for maximal
	command line length.

	Reported by: Tony Wyatt <wyattaw@optushome.com.au>

2003-06-23  Helmer Kraemer  <hkraemer@freenet.de>

	* kaffe/kaffevm/jit/machine.c
	(finishInsnSequence): adapted to modified alignment of gc heap
	(getInsnPC): new method
	(installMethodCode): use getInsnPC to translate exception table
	and line number table entries; corrected handling of exception
	table entries that cover the last instruction of a method

	* kaffe/kaffevm/jit3/machine.c
	(getInsnPC, installMethodCode): properly deal with exception table
	entries that cover the last instruction of a method
	
2003-06-22  Dalibor Topic <robilad@yahoo.com>

	* gwqt.m4:
	Link to math library when linking with QPE.

	Reported by:  Sankalpa Gamwarige <sgamwarige@sri.crossvue.com>

2003-06-22  Rob Gonzalez <rgonzale@wso.williams.edu>

	* kaffe/man/kaffe.1.in:
	documented -verify flag.

2003-06-20  Helmer Kraemer  <hkraemer@freenet.de>

	* kaffe/kaffevm/mem/gc-mem.h
	(GCBLOCK_OVH): removed
	(MEMALIGN): defined to alignment of jdoubles

	* kaffe/kaffevm/mem/gc-mem.c
	(gc_system_alloc): renamed to gc_heap_grow 
	(gc_free): fixed initialisation of free list
	(gc_malloc): moved invocation of garbage collector  ...

	* kaffe/kaffevm/mem/gc-incremental.c
	(gcMalloc): ... to here
	
2003-06-20  Helmer Kraemer  <hkraemer@freenet.de>

	* config/sparc/openbsd2/md.h (SP_OFFSET): define it to 2

	Reported by: Riccardo Mottola <zuse@libero.it>

2003-06-14 Dalibor Topic <robilad@yahoo.com>

	* configure.in:
	Configuration fixes for m68k-amigaos. Split huge lines
	into smaller ones.

	Reported by: Tony Wyatt <wyattaw@optushome.com.au>
	
2003-06-14 Dalibor Topic <robilad@yahoo.com>

	Compilation fixes for s390-linux.

	* configure.in:
	Added checks for sin6_flowinfo and sin6_scope_id in struct
	sockaddr_in6.

	* libraries/clib/net/InetAddressImpl.c:
	(java_net_NativeInetAddressImpl_getHostByAddr0) Only set
	sin6_flowinfo and sin6_scope_id if they are available on the
	platform.

	Reported by: Robert P. Nix <nix.robert@mayo.edu>

2003-06-14 Dalibor Topic <robilad@yahoo.com>

	* Makefile.am:
	(EXTRA_DIST) Added ChangeLog.5.

2003-06-14 Ito Kazumitsu <kaz@maczuka.gcd.org>

	* include/dummyin6.h:
	Changed uint32_t to int because such systems that needs dummyin6.h
	may not have uint32_t.

2003-06-13 Ito Kazumitsu <kaz@maczuka.gcd.org>

	* include/dummyin6.h:
	Add missing members sin6_flowinfo and sin6_scope_id to sockaddr_in6.

2003-06-13 Dalibor Topic <robilad@yahoo.com>

	* Makefile.am, include/Makefile.am:
	Add missing new files to make 'make distcheck' work.

2003-06-12 Florian La Roche <laroche@redhat.com>

	* config/s390/linux/md.h:
	(SIGNAL_ARGS, SIGNAL_CONTEXT_POINTER, GET_SIGNAL_CONTEXT_POINTER,
	SIGNAL_PC) defined for s390-linux.

2003-06-12 Dalibor Topic <robilad@yahoo.com>

	Compilation fixes for s390-linux.
	
	* configure.in:
	Merged in checks for va_copy and __va_copy from LGPLd Wine
	configure.ac.

	* include/defs.h:
	(VA_LIST_COPY) new macro to copy va_lists.

	* kaffe/kaffevm/stringParsing.c:
	(pushFrame, parseString_private) use VA_LIST_COPY.
	
2003-06-12 Dalibor Topic <robilad@yahoo.com>

	* developers/autogen.sh:
	Don't apply developers/getaddrinfo-socketinttypes-glibc2.diff,
	simply use the patched up version.
	
2003-06-12 Dalibor Topic <robilad@yahoo.com>

	Linux 2.0.x IPv6 support compilation fixes.

	* aclocal.m4, config/config.h.in,
	configure, replace/Makefile.in: Regenerated.

	* configure.in:
	Check for getaddrinfo and getnameinfo, and use
	replacement implementaitons if necessary. Added
	more checks for IPv6 features.

	* developers/getaddrinfo-socketinttypes-glibc2.diff:
	New file, patch to allow getaddrinfo to find in_port_t
	on Mandrake Linux 9.1.

	* developers/autogen.sh:
	Apply developers/getaddrinfo-socketinttypes-glibc2.diff.

	* herrno.m4, in6addr.m4, include/dummyin6.h,
	include/getaddrinfo.h, replace/dummyin6.c,
	replace/getaddrinfo.c, replace/memset.c,
	sockaddrin6.m4, sockinttypes.m4:
	New files, taken from BSD-type licensed getaddrinfo
	implementation version 1.5.1 from 
	http://www.sra.co.jp/people/m-kasahr/getaddrinfo/ .
	
	* libraries/clib/net/InetAddressImpl.c,
	libraries/clib/net/NetworkInterfaceImpl.c,
	libraries/clib/net/PlainSocketImpl.c:
	Use dummy IPv6 implementation and getaddrinfo if
	necessary.

	* replace/Makefile.am:
	(libreplace_la_SOURCES) Added dummyin6.c, getaddrinfo.c
	and memset.c.

	Based on a patch by: Ito Kazumitsu <kaz@maczuka.gcd.org>

	Reported by: Ito Kazumitsu <kaz@maczuka.gcd.org>,
	Kiyo Inaba <inaba@src.ricoh.co.jp>

2003-06-12 Dalibor Topic <robilad@yahoo.com>

	* test/regression/Reflect.java:
	Fixed expected output for java.lang.System.arraycopy.
	
2003-06-12 Dalibor Topic <robilad@yahoo.com>

	Linux 2.0.x IPv6 support compilation fixes.
	
	* configure.in:
	Added checks for linux/netlink.h, linux/rtnetlink.h and
	netpacket/packet.h.
	
	* replace/getifaddrs.c:
	Only compile replacement code if the headers linux/netlink.h,
	linux/rtnetlink.h and netpacket/packet.h are found.

	* replace/ifaddrs_linux.c:
	Only include linux/netlink.h, linux/rtnetlink.h and
	netpacket/packet.h if they are found by configure.
	
	Reported by: Ito Kazumitsu <kaz@maczuka.gcd.org>,
	Kiyo Inaba <inaba@src.ricoh.co.jp>
	
2003-06-12 Dalibor Topic <robilad@yahoo.com>

	* FAQ/FAQ.code-layout: new file.
	
2003-06-12 Dalibor Topic <robilad@yahoo.com>

	* configure.in: check for inet_ntop and inet_pton.

	* config/config.h.in, configure,
	kaffe/scripts/Makefile.in,
	kaffe/scripts/compat/Makefile.in,
	libltdl/config-h.in,
	replace/Makefile.in:
	regenerated.

	* replace/Makefile.am:
	(libreplace_la_SORCES) Add inet_ntop.c and inet_pton.c.

	* replace/inet_ntop.c, replace/inet_pton.c:
	new files, taken from ircii, distributed under a BSD type license.

2003-06-12 Dalibor Topic <robilad@yahoo.com>

	* libraries/clib/io/File.c:
	(java_io_File_createNewFile0) Always create file in binary mode.

	* kaffe/kaffevm/findInJar.c:
	(getClasspathType) Always open files in binary mode.

2003-06-12 Dalibor Topic <robilad@yahoo.com>

	* libraries/javalib/rebuildLib.in:
	fixed quoting of echoed output for NetBSD.

	Reported by: Milos Negovanovic <milosn@xtra.co.nz>
	
2003-06-12 Dalibor Topic <robilad@yahoo.com>

	* ChangeLog, ChangeLog.5: rotated changelogs.
	
2003-06-11  Helmer Kraemer  <hkraemer@freenet.de>

	* kaffe/kaffevm/baseClasses.c,
	kaffe/kaffevm/findInJar.c,
	kaffe/kaffevm/external.c,
	kaffe/kaffevm/gcFuncs.c,
	kaffe/kaffevm/itypes.c,
	kaffe/kaffevm/thread.c,
	kaffe/kaffevm/utf8const.c:
	add some debug messages to show the initialization steps
	
2003-06-11 Helmer Kraemer <hkraemer@freenet.de>

	* libraries/javalib/java/lang/System.java,
	libraries/clib/native/System.c:
	revert to the native implementation of arraycopy

See ChangeLog.5 for earlier changes.
