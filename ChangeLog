2005-01-05  Guilhem Lavaux  <guilhem@kaffe.org>

	* kaffe/kaffevm/systems/unix-pthreads/thread-impl.c
	(jthread_exit): Fix for a deadlock which can occur on process exit.

2005-01-04  Guilhem Lavaux  <guilhem@kaffe.org>

	* kaffe/kaffevm/systems/unix-pthreads/lock-impl.c,
	kaffe/kaffevm/systems/unix-pthreads/lock-impl.h:
	(KaffePThread_setBlockingCall, KaffePThread_clearBlockingCall):
	Defined two external functions to handle blocking syscalls (not
	interruptible by a signal).

	* kaffe/kaffevm/systems/unix-pthreads/syscalls.c
	(jthreadedWaitPid): Advertise the thread subsystem that we cannot
	receive any suspend signal in that syscall.
	
	* kaffe/kaffevm/systems/unix-pthreads/thread-impl.c	
	kaffe/kaffevm/systems/unix-pthreads/thread-internal.h: Handle the
	new blocking state.

2005-01-03  Dalibor Topic  <robilad@kaffe.org>

	* test/regression/Reflect.java: Adapted expected output to match
	arraycopy.

	Reported by:  Guilhem Lavaux  <guilhem@kaffe.org>

2005-01-03  Dalibor Topic  <robilad@kaffe.org>

	* libraries/javalib/java/lang/System.java (arraycopy): Moved error
	checking code from native part of the method into java part of 
	method's implementation. Improved exception messages.
	(arraycopy0) Renamed native part of the method accordingly.

	* test/internal/java/lang/System.java: Updated for new arraycopy
	implementation.

	* libraries/clib/native/System.c (java_lang_System_arraycopy):
	Renamed to java_lang_System_arraycopy0.

	* libraries/javalib/Klasses.jar.bootstrap: Regenerated.
	
2005-01-02  Guilhem Lavaux  <guilhem@kaffe.org>

	* kaffe/kaffevm/systems/unix-pthreads/lock-impl.c
	(setBlockState): Protect the mutex locking against signal.
	
	* kaffe/kaffevm/systems/unix-pthreads/thread-impl.c,
	kaffe/kaffevm/systems/unix-pthreads/thread-internal.h
	(KaffePThread_AckAndWaitForResume): New function.
	(suspend_handler): Call directly KaffePThread_AckAndWaitForResume
	now.
	(KaffePThread_getSuspendSignal): Export the signal number
	corresponding to the suspend signal.
	(jthread_suspendall): Cleant up the semaphore sweep. Added a few
	assertion checking.
	(jthread_unsuspendall): Added a few assertion checking.
	(tRun): Check whether the thread is killed when it is woken up.
	(jthread_exit): Do not cancel any thread as it may cause deadlocks
	on 2.4. Only interrupt and set the state to THREAD_KILL.

	* libraries/clib/native/Thread.c
	(VMThread.sleep): Check that if timeout is null we should return
	immediately.

2005-01-02  Dalibor Topic  <robilad@kaffe.org>

	* test/regression/TestSerializable2.java:
	Print stack traces in unexpected exceptions. Should help
	detect the reason of the last failing regression test
	on freebsd-amd64.

2005-01-01  Dalibor Topic  <robilad@kaffe.org>

	* TODO: Added a few more entries.

2005-01-01  Dalibor Topic  <robilad@kaffe.org>

	* ChangeLog: Shuffled around for new year.
	* ChangeLog.15: new file.

2005-01-01  Dalibor Topic  <robilad@kaffe.org>
	
	* test/internal/System.java: Removed.
	* test/internal/java/lang/System.java: Moved over here.
	
2005-01-01  Dalibor Topic  <robilad@kaffe.org>

	* test/internal/Makefile.am (CPATH): New variable
	as shortcut for classpath setting. Prepended '.' to
	classpath.
	
2005-01-01  Guilhem Lavaux  <guilhem@kaffe.org>

	* config/sparc/jit-alpha.def: Renamed setEpilogueLabel to
	KaffeJIT_setEpilogueLabel.

2005-01-01  Guilhem Lavaux  <guilhem@kaffe.org>

	* libraries/javalib/gnu/classpath/VMSystemProperties.java
	(preInit): Check if LOCALE is null.

	* kaffe/kaffevm/jni/jni-string.c
	(KaffeJNI_NewStringUTF): Use the right return path so that exceptions
	are handled correctly.

2005-01-01  Guilhem Lavaux  <guilhem@kaffe.org>

	* kaffe/kaffevm/classMethod.h
	(protectionDomain): Changed declaration to use the right type.

	* kaffe/kaffevm/systems/unix-jthreads/jsignal.h
	(registerAsyncSignalHandler, registerSyncSignalHandler): Fixed
	declaration.

	* libraries/clib/native/ClassLoader.c
	(java_lang_VMClassLoader_defineClass): Fixed declaration.

2005-01-01  Guilhem Lavaux  <guilhem@kaffe.org>

	* kaffe/kaffevm/intrp/methodcalls.c,
	kaffe/kaffevm/jit/methodcalls.c
	(engine_callMethod): Clear the return value to be sure that no
	bits are one.
	
	* kaffe/kaffevm/systems/unix-jthreads/signal.c,
	kaffe/kaffevm/systems/unix-pthreads/signal.c
	(detectStackBoundaries): Restore old signal handlers for SIGSEGV
	and SIGBUS.

2005-01-01  Guilhem Lavaux  <guilhem@kaffe.org>

	First bug fix of the year ! :)

	* kaffe/kaffevm/external.c: Adapted error handling to darwin's and
	openbsd's messages.

	* libraries/clib/classpath/Makefile.am: Added useful link flags
	for libclasspath.

	* libraries/clib/classpath/Makefile.in: Regenerated.
	
See ChangeLog.15 for earlier changes.
