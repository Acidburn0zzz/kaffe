1999-04-16  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* configure.in: Test whether we get an unexpected arithmetic
	exception for LONG_LONG_MIN % -1ll.
	* kaffe/kaffevm/intrp/icode.h (rem_long): Work around the bug.
	* configure, config/config.h.in: Regenerated.

	* kaffe/kaffevm/support.c (callMethodA): Add a `promoted'
	argument, that indicates whether sub-integer types have been
	promoted to int or not, and whether the result is to remain
	promoted or not.
	* kaffe/kaffevm/support.h (callMethodA): Update declaration.
	* kaffe/kaffevm/jni.c: Call callMethodA with promoted==0.
	* kaffe/kaffevm/intrp/machine.c: Call it with promoted==1.
	* kaffe/kaffevm/classMethod.c: Likewise; no arguments or result.
	* kaffe/kaffevm/gcFuncs.c: Likewise.

	* kaffe/kaffevm/intrp/machine.c (virtualMachine): Move the VM loop 
	into a separate function, runVirtualMachine(), that won't be
	affected by potential register problems related with setjmp, that
	remains in virtualMachine().  This has reduced the number of
	volatile variables referenced within the VM loop to zero, which
	should probably speed things up, at the cost a some additional
	stack space.  This has fixed almost all problems in sparc/intrp.

1999-04-15  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* config/alpha/sysdepCallMethod.h (sysdepCallMethod):
	Unfortunately, floats can't be promoted to doubles, so we have to
	explicitly test each argument whether it must be loaded as double, 
	float or long.  So, define PROMOTE_jfloat2jdouble to 0.
	* kaffe/kaffevm/support.c: Reintroduce PROMOTE_jfloat2jdouble and
	PROMOTE_jint2jlong, for finer-grained control on promotion.  We
	could have done with just PROMOTE_jint2jlong, but so what?
	* config/alpha/osf/config.frag: We need -mieee in CFLAGS for
	DoublePrint and DoubleComp to pass.
	* config/alpha/linux/config.frag: Likewise.
	* config/alpha/osf/md.c (init_md): IEEE_TRAP_ENABLE_INV breaks
	them too.  Now we pass all tests!
	* config/alpha/linux/md.c (init_md): Likewise.
	
Thu Apr 15 15:00:14 1999  Godmar Back  <gback@cs.utah.edu>

	* libraries/clib/native/ObjectStreamClassImpl.c: don't include
	<clinit> twice when computing serialVersionUID

1999-04-15  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* config/sparc/sysdepCallMethod.h (sysdepCallMethod): Moved from
	common.h.  Make it inlinable for short argument lists, by calling
	an alternate definition when there are too many arguments to pass
	in the registers.  It's still possible to get a single version
	with an appropriate #define.
	* config/sparc/common.h: Include sysdepCallMethod.h twice, once to 
	define the non-inlinable longSysdepCallMethod, once to define the
	inlinable sysdepCallMethod.
	* config/alpha/sysdepCallMethod.h (sysdepCallMethod): Likewise,
	but default to the single version in egcs 1.1.*, because it
	egcs crashes otherwise.  The bug is fixed in older releases and
	newer snapshots.
	* config/alpha/common.h: Likewise.
	* kaffe/kaffevm/support.c (PROM_DIV): Removed; use NO_HOLES.
	(PROMOTE_jint2jlong, PROMOTE_jfloat2jdouble): Removed; use
	PROMOTE_TO_64bits instead.
	(NO_HOLES): Semantically similar to PROM_DIV-1, but it allows
	proper implementation of jfloat2jdouble promotion.  Do not modify
	callsize.
	(ALIGN_AT_64bits): Operate only on jlongs and jdoubles.  Do not
	modify callsize.
	(ENSURE_ALIGN64): Accept one argument to adjust args.
	(callMethodA): Adjust args whenever we promote jfloat2jdouble, 
	remove a hole after a jlong or jdouble (even a promoted
	one), or insert a hole because of alignment.
	* config/mips/n32-sysdepCallMethod.h (sysdepCallMethod): Moved
	from mips.c.  Rewritten as a static inline function, similar with
	the ones for alpha.  Define NO_HOLES.
	* config/mips/o32-sysdepCallMethod.h (sysdepCallMethod): Likewise.
	Define ALIGN_AT_64bits.
	* config/mips/common.h: Include the appropriate sysdepCallMethod.
	If it cannot determined which one to use, print an error.
	* config/mips/mips.c: Removed.
	* config/mips/irix5/md.c: Do not include mips/mips.c.
	* config/mips/linux/md.c: Likewise.
	* config/mips/ultrix4/md.c: Removed definition of
	sysdepCallMethod, it's o32 ABI.  It may fail to select it, though, 
	and some #define may be needed.
	* config/Makefile.am (EXTRA_DIST): Removed mips/mips.c.  Added
	*/*sysdepCallMethod.h.
	* config/Makefile.in: Rebuilt.
	
	* test/regression/DoubleComp.java (DoubleComp): Add try/catch
	blocks so that it reports which tests cause ArithmeticExceptions.

1999-04-14  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* config/i386/common.h (sysdepCallMethod): Do not use extern
	inline, it prevents compilation without optimization; use static
	inline instead.
	* config/sparc/common.h (sysdepCallMethod): Rewrite as a static
	inline function, in a well-documented way, suitable for easy
	adaptation to other platforms, without *any* asm statement.
	* kaffe/kaffevm/support.c (PROMOTE_TO_64bits): Define
	PROMOTE_jint2jlong and PROMOTE_jfloat2jdouble.
	(PROMOTE_jint2jlong): Arrange that all integer types are promoted
	to 64bit words.  It currently doesn't cause padding arguments to
	be added if needed.
	(PROMOTE_jfloat2jdouble): Arrange that all floats are promoted to
	double.
	(PROM_DIV): If PROMOTE_jint2jlong and PROMOTE_jfloat2jdouble are
	defined, and pointers are as wide as two ints, set to 2,
	otherwise, set to 1.
	(callMethodA, callMethodV): Promote jints to jlongs and jfloats to 
	jdoubles where appropriate.  Divide all sizes of jfloats, jlongs,
	jdoubles and jrefs by PROM_DIV, and eliminate padding arguments if
	possible.
	* config/alpha/common.h (sysdepCallMethod): Rewrite as a static
	inline function very similar with the one for sparc.  Define
	PROMOTE_TO_64bits, since all arguments are 64bits, so that we
	don't have to skip holes.
	* kaffe/kaffevm/support.c (ALIGN_AT_64bits, callMethodA,
	callMethodV): If ALIGN_AT_64bits is defined, insert padding 32-bit 
	arguments as needed for 64bit ones to be aligned at even positions 
	in the array of arguments.

	* config/config.alias: Cygnus has renamed cygwin32 to cygwin, but
	our config directory is still named cygwin32.

1999-04-13  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* configure.in: Modify --with-libraries so that it also adds
	directories to the run-time search path.  Drop --with-rtlibraries,
	now that it's useless.  Do not add assume -I/usr/local/include if
	--with-includes is specified, nor -L/usr/local/lib for
	--with-libraries.  If X_LIBS contains any -L flag but no -R, add
	one -R for each -L.
	* FAQ/FAQ.automake: Remove references to --with-rtlibraries.
	* configure: Rebuilt.

	* libltdl/ltdl.c: Update from libtool.  Remove warnings.  Bug
	fixes for HP/UX.

	* config/i386/common.h (sysdepCallMethod): Update comments, and
	optimize a bit further.

Mon Apr 12 10:12:25 1999  Alan L. Batongbacal <alanlb@access.rrinc.com>

	* config/i386/beos/config.frag: removed explicit definition for CFLAGS
	because it interfered with --disable-debug option

1999-04-12  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* config/i386/common.h (sysdepCallMethod): Rewrite so that it
	compiles with egcs snapshots.  Make it an extern inline function,
	to ease debugging.  It will only be defined if
	NEED_sysdepCallMethod is defined.
	* kaffe/kaffevm/support.c: Include support.h and define
	NEED_sysdepCallMethod before machine.h.

Fri Apr  9 14:00:00 PDT 1999 Transvirtual Technologies <info@transvirtual.com>

        * Version 1.0.b4 of Kaffe OpenVM released.

See ChangeLog.2 for earlier changes.
