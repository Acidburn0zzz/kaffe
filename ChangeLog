2006-04-16  Guilhem Lavaux  <guilhem@kaffe.org>

	Fix for bug #35

	* FAQ/FAQ.kaffemd
	
	* configure.ac: Check for pthread_getattr_np

	* configure, config/config.h.in: Regenerated.

	* kaffe/jvmpi/jvmpi_kaffe.c
	(jvmpiFillThreadStart): Filling the JVMPI event structure the same
	way the JDK does (according to JMP).

	* kaffe/kaffevm/thread.c
	(KaffeVM_attachFakedThreadInstance): Build the JNI local reference
	table at that position to catch all newly attached thread.

	* kaffe/kaffevm/jni/jni-base.c
	(detectAllActiveThreads): Send a THREAD_START event for each
	running threads.
	(JNI_CreateJavaVM): Likewise.
	(KaffeJNI_DestroyJavaVM): Send a "shut down" JVMPI event
	
	* kaffe/kaffevm/jni/jni.c
	(Kaffe_DefineClass): Imported some code from
	ClassLoader.defineClass.

	* kaffe/kaffevm/systems/unix-pthreads/signal.c
	(detectStackBoundaries): Renamed to
	KaffePThread_detectStackBoundaries. Simplified the ifdef as
	onstack is not needed anymore for quite a while.
	(KaffePThread_detectThreadStackBoundaries): New function to detect
	stack boundaries for unknown pthreads.

	* kaffe/kaffevm/systems/unix-pthreads/thread-impl.c:
	(jthread_attach_current_thread): If the thread is already attached
	then return immediately. Detect stack boundaries. Setup signal
	handlers again.

	* libraries/javalib/vmspecific/gnu/classpath/VMSystemProperties.java:
	Updated VM version.
	
2006-04-15  Dalibor Topic  <robilad@kaffe.org>

	* libraries/javalib/external/classpath/configure.ac:
	Added CLASSPATH_CONVENIENCE substitution for convenience library LDFLAGS.

	* libraries/javalib/external/classpath/native/fdlibm/Makefile.am,
	libraries/javalib/external/classpath/native/jni/classpath/Makefile.am:
	Don't use -module and -version-info for convenience libraries LDFLAGS.
	Fixes libtool warnings.

2006-04-14  Riccardo Mottola <riccardo@kaffe.org>

	libraries/javalib/awt-implementations/kaffe/Makefile.am:
	Removed some classes that came from GNU Classpath.

	* libraries/javalib/awt-implementations/kaffe/java/awt/GridBagConstraints.java,
	libraries/javalib/awt-implementations/kaffe/java/awt/GridBagLayout.java,
	libraries/javalib/awt-implementations/kaffe/java/awt/GridBagLayoutInfo.java,
	libraries/javalib/awt-implementations/kaffe/java/awt/GridLayout.java,
	libraries/javalib/awt-implementations/kaffe/java/awt/dnd/Autoscroll.java,
	libraries/javalib/awt-implementations/kaffe/java/awt/dnd/DnDConstants.java,
	libraries/javalib/awt-implementations/kaffe/java/awt/dnd/DnDEventMulticaster.java,
	libraries/javalib/awt-implementations/kaffe/java/awt/dnd/DragGestureEvent.java,
	libraries/javalib/awt-implementations/kaffe/java/awt/dnd/DragGestureListener.java,
	libraries/javalib/awt-implementations/kaffe/java/awt/dnd/DragGestureRecognizer.java,
	libraries/javalib/awt-implementations/kaffe/java/awt/dnd/DragSource.java,
	libraries/javalib/awt-implementations/kaffe/java/awt/dnd/DragSourceAdapter.java,
	libraries/javalib/awt-implementations/kaffe/java/awt/dnd/DragSourceContext.java,
	libraries/javalib/awt-implementations/kaffe/java/awt/dnd/DragSourceDragEvent.java,
	libraries/javalib/awt-implementations/kaffe/java/awt/dnd/DragSourceDropEvent.java,
	libraries/javalib/awt-implementations/kaffe/java/awt/dnd/DragSourceEvent.java,
	libraries/javalib/awt-implementations/kaffe/java/awt/dnd/DragSourceListener.java,
	libraries/javalib/awt-implementations/kaffe/java/awt/dnd/DragSourceMotionListener.java,
	libraries/javalib/awt-implementations/kaffe/java/awt/dnd/DropTarget.java,
	libraries/javalib/awt-implementations/kaffe/java/awt/dnd/DropTargetAdapter.java,
	libraries/javalib/awt-implementations/kaffe/java/awt/dnd/DropTargetContext.java,
	libraries/javalib/awt-implementations/kaffe/java/awt/dnd/DropTargetDragEvent.java,
	libraries/javalib/awt-implementations/kaffe/java/awt/dnd/DropTargetDropEvent.java,
	libraries/javalib/awt-implementations/kaffe/java/awt/dnd/DropTargetEvent.java,
	libraries/javalib/awt-implementations/kaffe/java/awt/dnd/DropTargetListener.java,
	libraries/javalib/awt-implementations/kaffe/java/awt/dnd/InvalidDnDOperationException.java,
	libraries/javalib/awt-implementations/kaffe/java/awt/dnd/MouseDragGestureRecognizer.java,
	libraries/javalib/awt-implementations/kaffe/java/awt/dnd/package.html,
	libraries/javalib/awt-implementations/kaffe/java/awt/dnd/peer/DragSourceContextPeer.java,
	libraries/javalib/awt-implementations/kaffe/java/awt/dnd/peer/DropTargetContextPeer.java,
	libraries/javalib/awt-implementations/kaffe/java/awt/dnd/peer/DropTargetPeer.java,
	libraries/javalib/awt-implementations/kaffe/java/awt/dnd/peer/package.html:
	Removed.

2006-04-14  Dalibor Topic  <robilad@kaffe.org>

	* kaffe/kaffevm/jit3/icode.c,
	kaffe/kaffevm/jit3/codeproto.h (softcall_lookupinterfacemethod):
	Added missing const to Method parameter to fix compiler warning.

2006-04-14  Dalibor Topic  <robilad@kaffe.org>

	* kaffe/kaffevm/exception.c (dispatchException): 
	Added missing cast for fix compiler warning.

2006-04-14  Dalibor Topic  <robilad@kaffe.org>

	* kaffe/kaffevm/ksem.h,
	kaffe/kaffevm/ksem.c (ksem_put, ksem_get),
	kaffe/kaffevm/locks.c (getHeavyLock, putHeavyLock, slowLockMutex,
	slowUnlockMutex, locks_internal_slowUnlockMutexIfHeld, 
	locks_internal_waitCond, locks_internal_signalCond, 
	locks_internal_broadcastCond, locks_internal_lockMutex) Removed
	volatile qualifiers and casts to fix compiler warnings.
	
2006-04-13  Riccardo Mottola <riccardo@kaffe.org>

	* libraries/javalib/awt-implementations/kaffe/java/awt/Component.java:
	copied over change property methods from classpath
	
2006-04-12  Dalibor Topic  <robilad@kaffe.org>

	* kaffe/xprof/mangle.c (mangleClassType): 
	Added missing cast to ptrdiff_t to fix compiler warning.

2006-04-06  Dalibor Topic  <robilad@kaffe.org>

	* kaffe/kaffevm/readClass.c (readSignatureAttribute): 
	Guarded to avoid building it for kaffeh.

2006-04-06  Dalibor Topic  <robilad@kaffe.org>

	* kaffe/kaffevm/classMethod.h: Made 
	methods.c.bcode.codelen an unsigned int.

	* kaffe/kaffevm/code-analyse.c (analyzeBasicBlock): 
	Removed unnecessary casts. Moved function up, so
	that the static prototype could be removed. Changed
	parameter pc's type to uint32.
	(analyzeMethod): Made pc an uint32.

	* kaffe/kaffevm/verifier/verify3a.c (verifyMethod3a): 
	Throw a verifier error if code length is 0.

2006-04-06  Dalibor Topic  <robilad@kaffe.org>

	* kaffe/kaffevm/object.c (newArrayChecked): Added assert to check
	that count is >= 0. Simplified a bit, and added casts to fix
	compiler warnings.

	* include/Arrays.h: Explicitely name structs in typedefs.

	* kaffe/kaffevm/jit3/machine.h, 
	kaffe/kaffevm/jit/machine.h,
	kaffe/kaffevm/intrp/machine.h: Include Arrays.h.

	* kaffe/kaffevm/object.h (OBJECT_DTABLE_OFFSET) 
	(ARRAY_SIZE_OFFSET, ARRAY_DATA_OFFSET): Use offsetof instead of
	wild casts.

2006-04-05  Dalibor Topic  <robilad@kaffe.org>

	* libraries/clib/zip/CRC32.c: Use zlib implementation. Added
	explicit casts to fix compiler warnings.

2006-04-05  Dalibor Topic  <robilad@kaffe.org>

	* libraries/clib/zip/Adler32.c (java_util_zip_Adler32_update1) 
	(java_util_zip_Adler32_update): Added explicit casts to fix
	compiler warnings.

2006-04-03  Dalibor Topic  <robilad@kaffe.org>

	* kaffe/kaffevm/boehm-gc/boehm/cord/de.c,
	libraries/clib/target/generic/target_generic.h,
	libraries/clib/target/generic/target_generic_misc.h:
	Fixed remaining pscan warnings.

2006-04-03  Dalibor Topic  <robilad@kaffe.org>

	* THIRDPARTY: Updated fastjar to gcc 4.1.0.

	* external/gcc/fastjar: Updated to 4.1.0.

2006-04-03  Dalibor Topic  <robilad@kaffe.org>

        * Resynchronized GNU Classpath.

2006-04-03  Dalibor Topic  <robilad@kaffe.org>

	* THIRDPARTY: Updated to boehm-gc 6.7

	* kaffe/kaffevm/boehm-gc/boehm/ : Updated to boehm-gc 6.7.
	All regression tests pass now with boehm-gc/jit3/pthreads 
	on x86-linux.

2006-04-02  Dalibor Topic  <robilad@kaffe.org>

	* libraries/javalib/vmspecific/java/lang/reflect/Array.java,
	libraries/clib/native/Array.c: Removed.

	* libraries/javalib/vmspecific/java/lang/reflect/Constructor.java
	libraries/javalib/vmspecific/java/lang/reflect/Field.java
	libraries/javalib/vmspecific/java/lang/reflect/Method.java:
	Added missing methods from GNU Classpath.

	* libraries/javalib/vmspecific/java/lang/reflect/VMArray.java
	libraries/clib/native/java_lang_reflect_VMArray.c: New files,
	taken from GNU Classpath.

	* include/Makefile.am: Don't generate include file for Array.

	* libraries/clib/native/Makefile.am: Removed Array.c. Added 
	java_lang_reflect_VMArray.c.

        * Resynchronized GNU Classpath.

2006-04-02  Dalibor Topic  <robilad@kaffe.org>

	Fix for #32.

	* configure.ac: Make --disable-native-awt disable GNU Classpath's
	gtk peer as well.

2006-04-01  Kiyo Inaba <inaba@src.ricoh.co.jp>

	Really fix for #31.

	* kaffe/kaffevm/intrp/methodcalls.c: Reorder the variables
	declaration compatible with older C syntax.

2006-04-01  Guilhem Lavaux  <guilhem@kaffe.org>

	* kaffe/kaffevm/kaffe.def
	(PUTFIELD, PUTSTATIC): Updated semantic to follow JDK 1.5 behaviour.

	* libraries/javalib/vmspecific/java/lang/reflect/Field.java
	(checkFinal): Follow JSR133 recommandation regarding final fields
	being modifiable if setAccessible has been invoked.

2006-03-31  Riccardo Mottola  <riccardo@kaffe.org>

	* libraries/javalib/awt-implementations/kaffe/java/awt/AWTEvent.java,
	libraries/javalib/awt-implementations/kaffe/java/awt/Toolkit.java,
	libraries/javalib/awt-implementations/kaffe/java/awt/event/WindowEvent.java:
	Updated AWT implementation by importing 1.3/1.4 stuff from classpath

2006-03-28  Guilhem Lavaux  <guilhem@kaffe.org>

	* kaffe/kaffeh/main.c

	* kaffe/kaffevm/access.h: Moved kaffe flags on class members into
	its own namespace. Added Java 1.5 accessibility flags.

	* kaffe/kaffevm/baseClasses.c
	(initialiseKaffe): Added support for Signature and Synthetic
	keywords.

	* kaffe/kaffevm/classMethod.c
	(addInnerClasses): Copy accessibility flags.
	(addMethod): put kaffe flags into its own variable. 

	* kaffe/kaffevm/classMethod.h
	(Hjava_lang_Class): Added fields to support kaffe flags and
	extended Java 1.5 signature.
	Kaffe Flags are in their own variable now.

	* kaffe/kaffevm/code-analyse.c: Likewise.

	* kaffe/kaffevm/code-analyse.h
	(CONSTANTTYPE): Added support for CONSTANT_Class and
	CONSTANT_ResolvedClass.
	(SET_NEWFRAME): Updated kaffe flags.

	* kaffe/kaffevm/external.c: Updated kaffe flags.

	* kaffe/kaffevm/gtypes.h: Introduced a new type for kaffe flags.

	* kaffe/kaffevm/kaffe.def
	(LDC): Class can be loaded directly now as of Java 1.5.
	(PUTFIELD, PUTSTATIC): Updated checking of accessibility to Java
	1.5 standard.
	
	* kaffe/kaffevm/readClass.c
	(readSignatureAttribute): New function.
	(readAttributes): Added support for Synthetic and Signature.

	* kaffe/kaffevm/readClass.h: Added support for Java 1.5 classes.

	* kaffe/kaffevm/gcj/gcj-glue.c,
	kaffe/kaffevm/intrp/machine.c,
	kaffe/kaffevm/jit/native-wrapper.c,
	kaffe/kaffevm/jni/jni.c,
	kaffe/kaffevm/intrp/methodcalls.c,
	libraries/clib/native/Class.c: Updated kaffe flags.
	
	* kaffe/kaffevm/intrp/machine.h,
	kaffe/kaffevm/jit3/machine.h,
	kaffe/kaffevm/jit/machine.h
	(current_method): New icode.

	* test/internal/jit_stub.c: Updated to new internal API.
	
2006-03-29  Dalibor Topic  <robilad@kaffe.org>

	Fix for #31.
	
	* kaffe/kaffevm/intrp/methodcalls.c: Added
	missing include to define jvalue.

2006-03-28  Dalibor Topic  <robilad@kaffe.org>

	* kaffe/kaffe/main.c,
	kaffe/kaffe/version.c,
	kaffe/kaffeh/main.c:
	Fixed pscan security warnings.

2006-03-28  Dalibor Topic  <robilad@kaffe.org>

	* external/gcc/fastjar/jartool.c: Cast filenames to char*
	before calling canonical_filename to fix compiler warnings.

2005-03-28  Antoine Reilles  <tonio@kaffe.org>,
	    Joerg Sonnenberger  <joerg@britannica.bec.de>

	* external/gcc/fastjar/jartool.c: Fix security problem for 
	fastjar reported at : http://secunia.com/advisories/14902
	Confirmed by Dalibor.

	Use a canonical_filename function as proposed by joerg, 
	since the problem can't be fixed by realpath, see
	http://mail-index.netbsd.org/tech-pkg/2006/03/07/0002.html

2006-03-27  Dalibor Topic  <robilad@kaffe.org>

	* ChangeLog.18, ChangeLog: Moved old change logs to 
	ChangeLog.18.

	* Makefile.am (EXTRA_DIST): Added ChangeLog.18.

	* developers/autogen.sh: Don't try to apply patch for 
	config.sub if it has already been applied.

2006-03-27  Kurt Miller <kurt@intricatesoftware.com>

        * config/powerpc//threads.h: (THREADSTACKSIZE) Increased
        stack size.

2006-03-27  Dalibor Topic  <robilad@kaffe.org>

        * ChangeLog: Updated Kurt Miller's e-mail address.

2006-03-27  Dalibor Topic  <robilad@kaffe.org>

        * configure.ac, README: Bumped version number up to 1.1.8-pre.

See ChangeLog.17 for earlier messages.

