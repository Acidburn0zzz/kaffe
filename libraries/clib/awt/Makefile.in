# generic AWT support for standard Java libraries
#
# Copyright (c) 1998
#	Transvirtual Technologies, Inc.  All rights reserved.
#
# See the file "lib-license.terms" for information on usage and redistribution 
# of this file. 

@VPATHOPT@=	@srcdir@@VPATHSEP@@srcdir@/X
srcdir=		@srcdir@
prefix=		@prefix@
exec_prefix=	@exec_prefix@
nativedir=	@libdir@
CC=		@CC@
LD=		@LD@
AR=		@AR@
RANLIB=		@RANLIB@
INCLUDES=	-I$(srcdir) -I../../../include -I$(srcdir)/../../../include -I../../../config -I$(srcdir)/../../../config -I$(srcdir)/X @X_INCLUDES@
CFLAGS=		@CFLAGS@
ALL_CFLAGS=	$(CFLAGS) $(INCLUDES) $(EXTRA_CFLAGS)
INSTALL=	@INSTALL@
INSTALL_DATA=	@INSTALL_DATA@
MKDIR=		@MKDIR@
LN=		@LN_S@
TOUCH=		touch
DLLTOOL=	@DLLTOOL@
PIC=		@PIC@
LDFLAGS=	@LIBSHARE@
LIBS=		@LIBS@
LDTAIL=		@LDTAIL@ @AWTLIB@
KVER=		@KVER@
OBJEXT=		@OBJEXT@
LIBEXT=		@LIBEXT@

LIBNAME=	libawt
LIB=		$(LIBNAME)$(LIBEXT)
LIBV=		$(LIBNAME)$(LIBEXT).$(KVER)

WRAPPER_CMD=	"s%^\(Java_[^(]*\).*$$%KAFFE_NATIVE(\1)%p"

OBJECT=

all:		$(LIB)

OBJECT=\
		X/tlk$(OBJEXT) \
		X/wnd$(OBJEXT) \
		X/evt$(OBJEXT) \
		X/gra$(OBJEXT) \
		X/fnt$(OBJEXT) \
		X/clr$(OBJEXT) \
		X/img$(OBJEXT) \
		X/cbd$(OBJEXT) \

$(LIB):         .dir-stamp $(OBJECT) lib.exp external_wrappers.h
		@LINKLIB@

.dir-stamp:
		test -d X || $(MKDIR) X
		$(TOUCH) .dir-stamp

.c$(OBJEXT):
		$(CC) $(ALL_CFLAGS) -c $(PIC) $< -o $*.o

external_wrappers.h:	$(OBJECT)
		sed -n $(WRAPPER_CMD) $(srcdir)/X/*.c > external_wrappers.h

clean:
		rm -f $(LIB) $(OBJECT) lib.exp external_wrappers.h

distclean:	clean
		rm -f Makefile .dir-stamp .depend
		rmdir X

install:
		test -d $(nativedir) || $(MKDIR) $(nativedir)
		rm -f $(nativedir)/$(LIB) $(nativedir)/$(LIBV)
		$(INSTALL_DATA) $(LIB) $(nativedir)/$(LIBV)
		$(LN) $(LIBV) $(nativedir)/$(LIB)

lib.exp:
		$(DLLTOOL) --def $(srcdir)/$(LIBNAME).def --output-exp lib.exp --output-lib $(LIBNAME).a --dllname $(LIB)
		touch lib.exp

X/tlk$(OBJEXT): X/tlk.c X/toolkit.h

X/wnd$(OBJEXT): X/wnd.c X/toolkit.h

X/evt$(OBJEXT): X/evt.c X/toolkit.h

X/gra$(OBJEXT): X/gra.c X/toolkit.h

X/fnt$(OBJEXT): X/fnt.c X/toolkit.h

X/clr$(OBJEXT): X/clr.c X/toolkit.h

X/img$(OBJEXT): X/img.c X/toolkit.h

X/cbd$(OBJEXT): X/cbd.c X/toolkit.h

