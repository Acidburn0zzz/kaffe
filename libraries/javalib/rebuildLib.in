#! /bin/sh
#
# rebuildLib - rebuild everything in one sweep
#              (without using any pre-compiled classes)
#
# Copyright (c) 1998, 1999
#      Transvirtual Technologies, Inc.  All rights reserved.
#
# See the file "license.terms" for information on usage and redistribution
# of this file.
#

SRCDIR=${srcdir-`sed -n '/^srcdir *= */ s///p' < Makefile`}
LIBDIR=${LIBDIR-`sed -n '/^LIBDIR *= */ s///p' < Makefile`}
LIBDIR=${LIBDIR-lib}
TOPBLD=${top_builddir-`sed -n '/^top_builddir *= */ s///p' < Makefile`}

JIKES=@JIKES@

rm -rf $LIBDIR
mkdir $LIBDIR
LIBDIR=`cd $LIBDIR && pwd`
VERBOSE=

if [ "$JIKES" = "" ] ; then
	if [ -z "$JAVA" ]; then
# use this if you have the memory
# this should not cause any gc and is fastest.
		test -f ${TOPBLD}/BUILD_ENVIRONMENT &&
		. ${TOPBLD}/BUILD_ENVIRONMENT
		JAVA="$JAVA -ms64M -mx64M"
# else use this.  ca. 36M seems to be the minimum at this point.
# note that kaffe doesn't always throw out-of-memory exception may just 
# silently deadlock if it runs out of memory.
#		JAVA="kaffe -ms40M -mx40M"
	fi
	if [ -z "$JAVAC" ]; then
		JAVAC="$JAVA pizza.compiler.Main"
	fi
	CPATH="-classpath $LIBDIR${CPATH+:$CPATH}"
else
	JAVAC="$JIKES"
	# CPATH is not needed for jikes
fi

cd $SRCDIR

echo "Compiling classes ..."
$JAVAC $VERBOSE -d $LIBDIR $CPATH ${1+"$@"}
