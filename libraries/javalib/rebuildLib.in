#! /bin/sh
#
# rebuildLib - rebuild everything in one sweep
#
# Copyright (c) 1998, 1999
#      Transvirtual Technologies, Inc.  All rights reserved.
#
# See the file "license.terms" for information on usage and redistribution
# of this file.
#

if [ -z "$1" ] ; then
    exit 0
fi

SRCDIR=${srcdir-`sed -n '/^srcdir *= */ s///p' < Makefile`}
LIBDIR=${LIBDIR-`sed -n '/^LIBDIR *= */ s///p' < Makefile`}
LIBDIR=${LIBDIR-lib}
TOPBLD=${top_builddir-`sed -n '/^top_builddir *= */ s///p' < Makefile`}

# We now rebuild the class library using kjc and Klasses.jar.bootstrap 
JIKES=@JIKES@
# JIKES=

LIBDIR=`CDPATH=: && cd $LIBDIR && pwd`
VERBOSE=

if [ -z "$JIKES" ] ; then
	if [ -z "$JAVA" ]; then
		test -f ${TOPBLD}/BUILD_ENVIRONMENT &&
		. ${TOPBLD}/BUILD_ENVIRONMENT
		BOOTCLASSPATH=${BOOTCLASSPATH}:${CLASSPATH}:${LIBDIR}; export BOOTCLASSPATH
		JAVA="$JAVA -verbosegc"
	fi
	if [ -z "$JAVAC" ]; then
		JAVAC="$JAVA at.dms.kjc.Main"
		VERBOSE=-v
	fi
	BOOTCLASSPATH=${SRCDIR}/Klasses.jar.bootstrap:$BOOTCLASSPATH; export BOOTCLASSPATH
else
	test -f ${TOPBLD}/BUILD_ENVIRONMENT && . ${TOPBLD}/BUILD_ENVIRONMENT
	CLASSPATH=${CLASSPATH}:${LIBDIR}
	JAVAC="$JIKES"
	CPATH="${CPATH+-classpath $CLASSPATH:$BOOTCLASSPATH}"
#	VERBOSE=${VERBOSE-"-verbose"}
fi

cd $SRCDIR

echo "Compiling classes from ${1+"$@"} using " $JAVAC
$JAVAC $VERBOSE $JAVAC_FLAGS -d $LIBDIR $CPATH ${1+"$@"}
